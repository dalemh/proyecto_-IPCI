<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
            <title>Musicfy</title>
         <meta content="" name="description">
          <meta content="" name="keywords">
        <link href="assets/css/Styles.css" rel="stylesheet" />
        <link href="https://cdn.datatables.net/1.10.20/css/dataTables.bootstrap4.min.css" rel="stylesheet" crossorigin="anonymous" />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/js/all.min.js" crossorigin="anonymous"></script>
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script> 
     
        <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
        
          <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" crossorigin="anonymous"></script>
          <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
          <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js" crossorigin="anonymous"></script>
          <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js" crossorigin="anonymous"></script>
          <script src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js" crossorigin="anonymous"></script>
      
    
    
    </head>
    <body>
        <nav class="sb-topnav navbar navbar-expand navbar-dark bg-dark">
            <a class="navbar-brand" href="index.html" id="tiposesion"></a>
               <!-- Navbar Search-->
            <form class="d-none d-md-inline-block form-inline ml-auto mr-0 mr-md-3 my-2 my-md-0">
                <div class="input-group">
                    <input class="form-control" type="text" placeholder="Buscar" aria-label="Search" aria-describedby="basic-addon2" />
                    <div class="input-group-append">
                        <button class="btn btn-primary" type="button"><i class="fas fa-search"></i></button>
                    </div>
                </div>
            </form>
            <!-- Navbar-->
            <ul class="navbar-nav ml-auto ml-md-0">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" id="userDropdown" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="fas fa-user fa-fw"></i></a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="userDropdown">
                        <a class="dropdown-item" href="#">Modificar perfil</a>
                        <a class="dropdown-item" href="#">Administrar usuarios</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="login.html">Logout</a>
                    </div>
                </li>
            </ul>
        </nav>
        <div id="layoutSidenav">
            <div id="layoutSidenav_nav">
                <nav class="sb-sidenav accordion sb-sidenav-dark" id="sidenavAccordion">
                    <div class="sb-sidenav-menu">
                        <div class="nav">
                            <div class="sb-sidenav-menu-heading">Funci√≥n Principal</div>
                            <a class="nav-link" href="index.html">
                                <div class="sb-nav-link-icon"><i class="fas fa-columns"></i></div>
                                Ver Canciones
                            </a>
                            <a class="nav-link" href="login.html">
                                <div class="sb-nav-link-icon"><i class="fas fa-table"></i></div>
                                Log out
                            </a>
                        </div>
                    </div>
                    <div class="sb-sidenav-footer">
 <!-- ############################################################################################################-->
                       
                        <div class="small">Logged in as:</div>
                        <a id="usuarioingresado" > </a>
                    </div>
  <!-- ############################################################################################################-->
                  
                </nav>
            </div>
            <div id="layoutSidenav_content">
                <main>
                   
<!-- ############################################################################################################-->
<!-- ############################################################################################################-->
                   


  <!-- ======= Mobile nav toggle button ======= -->
  <button type="button" class="mobile-nav-toggle d-xl-none"><i class="icofont-navigation-menu"></i></button>

  <!-- ======= Header ======= -->
  <header id="header">
    <div class="d-flex flex-column">
      <button type="button" class="mobile-nav-toggle d-xl-none"><i class="icofont-navigation-menu"></i></button>
    </div>
  </header>

  <body onload="MostrarCanciones()" id="main">
    <section id="about" class="about">
      <div class="container">
        <div class="section-title">
          <h2>Load Music</h2>

<!-- ############################################################################################################-->


<form class="form-inline">

	<div class="form-group">
		<label for="files">Ingrese archivo CSV: </label>
		<input type="file" id="file" class="form-control" accept=".csv" required />
	</div>

	<div class="form-group">
		<button type="button" onclick="cargarArchivo()" id="submit-file" class="btn btn-primary">leer archivo</button>
	</div>
	
</form>

<!-- ############################################################################################################-->




        </div>
        <table class="table">
            <thead>
                <tr>
                <th scope="col">Nombre</th>
                <th scope="col">Artista</th>
                <th scope="col">Album</th>
                <th scope="col">Release Date</th>
                <th scope="col">Portada</th>
                <th scope="col">Spotify</th>
                <th scope="col">Video</th>
                </tr>
            </thead>
            <tbody id="CuerpoCanciones">
            </tbody>
        </table>
        
    </section><!-- End About Section --> 
  <a href="#" class="back-to-top"><i class="icofont-simple-up"></i></a>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script> 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

  

    <script>
      function cargarArchivo(){
	    $('#file').parse({
		config: {
			delimiter: ";",
			complete: GuardarCanciones,
		},
		before: function(file, inputElem)
		{
			console.log("Parsing file...", file);
		},
		error: function(err, file)
		{
			console.log("ERROR:", err, file);
		},
		complete: function()
		{
			console.log("Done with all files");
		}
	    });
    };
   
     async function GuardarCanciones(results) {
        console.log(results.data)
        var data = results.data;
        var val = true


        for (i = 0; i < data.length; i++) {
            var nombre = data[i][0]
            var artista = data[i][1]
            var album = data[i][2]
            var fecha = data[i][3]
            var imagen = data[i][4]
            var spotify = data[i][5]
            var video = data[i][6]
            var objeto = {
                'nombre': nombre,
                'artista': artista,
                'album': album,
                'fecha': fecha,
                'imagen': imagen,
                'spotify': spotify,
                'video': video       
             }
            console.log(objeto)
            fetch('http://0.0.0.0:5000/cancion', {
            method: 'POST',
            body: JSON.stringify(objeto),
            headers:{
                'Content-Type': 'application/json'
            }
            }).then(res => res.json())
            .catch(error => {
                console.error('Error:', error)
                alert("Ocurrio un error al consumir la API, revise la consola")
                val = false
            })
            .then(response =>{
                console.log('Success:', response);
            }) 
            }
            if(val = true)
            {
                alert("Se agregaron las canciones exitosamente")
    			      MostrarCanciones()
            }
    }

        function MostrarCanciones(){

            var nombre = document.querySelector('#usuarioingresado')
          var iniciado = sessionStorage.usuario
          nombre.innerHTML = `</br> ${iniciado}` 


          var nombre2 = document.querySelector('#tiposesion')
          var tipo = sessionStorage.tipo
          nombre2.innerHTML = `${tipo}` 

            var contenido = document.querySelector('#CuerpoCanciones') 
            contenido.innerHTML = ""
            fetch('http://0.0.0.0:5000/cancion')
            .then(response => response.json())
            .catch(error => {
            console.log(error)
            })
            .then(res => {
            for (var i in res) {
                console.log(res[i])
                contenido.innerHTML += 
                `<tr>
                <th>${res[i].nombre}</th>
                <th>${res[i].artista}</th>
                <th>${res[i].album}</th>
                <th>${res[i].fecha}</th>
                <th><img src="${res[i].imagen}" class="img-fluid" height="100%" width="100%"> </th>
                <th><iframe src="${res[i].spotify}" width="250" height="240" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe></th>
                <th><iframe width="275" height="240" src="${res[i].video}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></th>
                </tr>`
            }
            })
      }


  </script>




 <!-- Template Main JS File -->
 <script src="assets/js/main.js"></script>
 

    </body>
</html>
